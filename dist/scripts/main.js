function init(){var e=Person,i=window.location.hash,t=$("nav#menu").find("a:not(.disabled)[href='"+i+"']");e.show(),$(".disabled").attr("title","功能未上线").css({color:"rgba(0,0,0,0.34)",cursor:"default"}).on("click",function(e){e.preventDefault(),e.stopPropagation()}),$("nav#menu").on("click","a:not(.disabled)",function(i){var t=$(this).attr("id");if(t){i.preventDefault(),"function"==typeof e.hide?e.hide():$("main > div").hide();var n={person:Person,p_introduction:Person,p_expr:Person,p_edu_expr:Person,p_work_expr:Person,p_skills:Person,p_hobbies:Person,p_contact:Person,s_musics:Musics,s_serials:Serials,w_programs:Projects};if("object"!=typeof n[t])throw new Error("Navigate failed:target object doesn't exited");if("function"!=typeof e.show)throw new Error("Navigate failed:target object haven't show function");e=n[t],e.show();var o=$(this).attr("href");$(o).length>0?($("main").animate({scrollTop:$(o)[0].offsetTop-10},600,"swing"),window.location.hash=o):window.location.hash=""}}),t.length>0&&t.click(),$(window).on("resize",function(){"function"==typeof e.resize&&e.resize()}),$("main").on("scroll",function(){"function"==typeof e.scroll&&e.scroll()})}var Comman=function(e){var i=function(e,i){var i=i||10;return scrollTop=$("main").scrollTop(),scrollHeight=$(e).height()+$(".header").height(),windowHeight=innerHeight,scrollWhole=Math.max(scrollHeight-scrollTop-windowHeight),scrollWhole<i},t=function(e,i,t){var t=t||1.5;return $("main").width()-$(e).width()>t*$(i).width()},n=function(e,n){return i(e)||t(e,n)},o=function(e){return!!(e&&$(e).length>=1)&&$(e).length};return{isScrollOver:i,testSelector:o,isFilled:t,isLoadData:n}}(window),Serials=function(e){function i(e){if("object"!=typeof e)throw new ReferenceError("Init Serials failed, param isn't a object");if(!Comman.testSelector(e.container))throw new ReferenceError("Init Serials failed, container selector doesn't existed or more than one");if(h=e.container,!Comman.testSelector(e.grid))throw new ReferenceError("Init Serials failed, grid selector isn't existed or more than one");g=e.grid,t()}function t(){$(g).on("click",".grid-item",a),$(g).masonry({itemSelector:".grid-item",gutter:10,fitWidth:!0})}function n(e){return"★★★★★★★★★★☆☆☆☆☆☆☆☆☆☆".slice(10-Math.ceil(e),20-Math.round(e))}function o(e){var i={updating:"更新中",end:"完结",schedule:"预定",unknow:"未知"};return i[e]?i[e]:"未知"}function r(e){var i,t,r="";for(t=0,i=e.length;t<i;t++){d=e[t];var s,a,l=d.release_date?"<span class='release_date_item'>("+d.release_date.slice(0,4)+")</span>":"",p="<p class='c_name_item'>"+d.c_name+l+"</p>",m=d.f_name?"<p class='f_name_item'>外文名："+d.f_name+"</p>":"",f=d.director?"<p class='director_item'>导演："+d.director+"</p>":"",u=d.actors?"<p class='acots_item'>演员："+d.actors.split(",").join("/")+"</p>":"",h=d.issuer?"<p class='issuer_item'>发行公司："+d.issuer+"</p>":"",g="",w=d.distinct?"<p class='distinct_item'>地区："+d.distinct+"</p>":"",_=d.state?"<p class='state_item'>状态："+o(d.state)+"</p>":"",v="",$=d.duration?"<p class='duration_html_item'>每集时长："+d.duration+"</p>":"",y=d.episode_number?"<p class='episode_number_item'>集数："+d.episode_number+"</p>":"",b=d.season_number?"<p class='season_number'>季数："+d.season_number+"</p>":"",x=d.reco_index?parseFloat(d.reco_index).toFixed(1):0,S=d.type_index?parseFloat(d.type_index).toFixed(1):0,j=d.douban_index?parseFloat(d.douban_index).toFixed(1):0,P=x>0?"<p class='reco_index_item'>评分："+n(x)+" <span>"+x+"</span></p>":"",E=S>0?"<p class='type_index_item'>类型分："+n(S)+" <span>"+S+"</span></p>":"",I=j>0?"<p class='douban_index_item'>豆瓣评分："+n(j)+" <span>"+j+"</span></p>":"",M=d.synopsis?"<div class='synopsis_item'><p>"+d.synopsis+"</p></div>":"",R=d.posters instanceof Array&&d.posters.length>0?"<img src='"+c+d.posters[Math.floor(Math.random()*d.posters.length)]+"'>":"",T="<p>添加日期："+d.date+"</p>",k=(d.types?d.types.split(","):[],d.tags?d.tags.split(","):[]),C=new Date(d.date),z=new Date,A="";for(s=0,a=k.length;s<a;s++)g+="<a href='./admin/doSerialsAdmin.php'>"+k[s]+"</a>";for(s=0,a=k.length;s<a;s++)v+="<a href='./admin/doSerialsAdmin.php'>"+k[s]+"</a>";g=g?"<div class='types_item'>"+g+"</div>":"",v=v?"<div class='tags_item'>"+v+"</div>":"",d.reco_index&&d.reco_index>=9?A="recommend":z.getTime()-C.getTime()<6048e5&&(A="new_add"),r+="<div class='grid-item "+A+"' data-id='"+d.id+"'><div class='serials_info'>"+R+p+m+f+u+h+w+_+$+y+b+P+E+I+g+v+T+"</div>"+M+"</div>"}return r}function s(){if(!(u||(p-1)*m>=f)&&Comman.isLoadData(g,".grid-item")){u=!0;var e={type:"GET",url:"./admin/doSerialsAdmin.php?act=get&pageSize="+m+"&page="+p++,error:function(e){console.log("页面请求失败...")},success:function(e){var i,t,n=JSON.parse(e),o=n.data;return f=n.total,n.error?void console.log(n.error):(i=r(o),t=$(i),$(g).append(t).masonry("appended",t),u=!1,void $(g).imagesLoaded().progress(function(e,i){i.isLoaded||(i.img.outerHTML="<img>"),$(g).masonry("layout")}).always(function(e){s()}))}};return void $.ajax(e)}}function a(){var e={type:"GET",url:"./admin/doSerialsAdmin.php?act=getImagesById&id="+$(this).attr("data-id"),error:function(e){},success:function(e){var i,t,n=JSON.parse(e),o=n.posters?n.posters:[],r=n.images?n.images:[],s=[];if(n.error)return void console.log(n.error);for(i=0,t=o.length;i<t;i++)s.push({src:c+o[i]});for(i=0,t=r.length;i<t;i++)s.push({src:l+r[i]});$.magnificPopup.open({items:s,gallery:{enabled:!0},type:"image"})}};$.ajax(e)}var c="admin/uploads/posters/",l="admin/uploads/images/",p=1,m=1,f=9999,u=!1,h="",g="";return{init:i,show:function(){$(h).show(),s()},hide:function(){$(h).hide()},scroll:s,resize:s}}(window),Musics=function(e){function i(e){if("object"!=typeof e)throw new ReferenceError("Init Musics failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Musics failed, container selector doesn't existed or more than one");if(d=e.container,"string"!=typeof e.grid||1!==$(e.grid).length)throw new ReferenceError("Init Musics failed, grid selector isn't existed or more than one");c=e.grid,$(c).masonry({itemSelector:".music_item",gutter:10,fitWidth:!0})}function t(){if(!(a||(o-1)*r>=s)&&Comman.isLoadData(c,".music_item")){a=!0;var e={type:"GET",url:"admin/doMusicsAdmin.php?act=get&pageSize="+r+"&page="+o++,error:function(e){console.log("页面请求失败...")},success:function(e){var i,o=JSON.parse(e),r="";s=o.total,o.error&&console.log(o.error),r=n(o.musics),i=$(r),$(c).append(i).masonry("appended",i),$(c).masonry("layout"),a=!1,t()}};$.ajax(e)}}function n(e){var i,t,n='<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling=no height=86 src="http://music.163.com/outchain/player?type={type}&id={id}&auto=0&height=66"></iframe>',o="",r="";for(i=0,t=e.length;i<t;i++)r=n.replace("{type}",e[i].type),r=r.replace("{id}",e[i].m_id),o+="<div class='music_item'><div>"+r+"</div><div class='music_comment'><p>"+e[i].comment+"</p><p class='update_date'>"+e[i].date+"</p></div></div>";return o}var o=1,r=1,s=9999,a=!1,d="",c="";return{init:i,show:function(){console.log("music"),$(d).show(),t()},hide:function(){$(d).hide()},scroll:t,resize:t}}(window),Person=function(e){function i(e){if("object"!=typeof e)throw new ReferenceError("Init Person failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Person failed, container's selector doesn't existed or more than one");o=e.container}function t(){$(o).show()}function n(){$(o).hide()}var o="";return{init:i,show:t,hide:n}}(window),Projects=function(e){var i,t,n,o;return t=function(e){if("object"!=typeof e)throw new ReferenceError("Init Project failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Project failed, container selector doesn't existed or more than one");if(n=e.container,!Comman.testSelector(e.grid))throw new ReferenceError("Init Project failed, grid selector isn't existed or more than one");o=e.grid},i=function(){$(n).show(),$(o).masonry("layout")},hide=function(){$(n).hide()},{init:t,show:i,hide:hide}}(window);$(window).ready(function(){Serials.init({container:".serials",grid:".serialsCard"}),Musics.init({container:".musics",grid:".music_card"}),Person.init({container:".about_him"}),Projects.init({container:".programs",grid:".grid"}),init()}),$("nav#menu").mmenu({extensions:["effect-slide-menu","shadow-panels"],counters:!0,navbar:{title:"Advanced menu"},navbars:[{position:"top",content:["searchfield"]},{position:"top",content:["prev","title","close"]},{position:"bottom",content:['<a href="admin/index.html" target="_blank">打开后台</a>']}],onClick:{close:!0,setSelected:!0}}),$(".grid").masonry({itemSelector:".grid-item",gutter:10,fitWidth:!0});