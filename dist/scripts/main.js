function init(){var e=Person,n=window.location.hash,i=$("nav#menu").find("a:not(.disabled)[href='"+n+"']");e.show(),$(".disabled").attr("title","功能未上线").css({color:"rgba(0,0,0,0.34)",cursor:"default"}).on("click",function(e){e.preventDefault(),e.stopPropagation()}),$("nav#menu").mmenu({extensions:["effect-slide-menu","shadow-panels"],counters:!0,navbar:{title:"Advanced menu"},navbars:[{position:"top",content:["searchfield"]},{position:"top",content:["prev","title","close"]},{position:"bottom",content:['<a href="admin/index.html" target="_blank">打开后台</a>']}],onClick:{close:!0,setSelected:!0}}),$("nav#menu").data("mmenu").update(),$("nav#menu").on("click","a:not(.disabled)",function(n){var i=$(this).attr("id");if(i){n.preventDefault(),"function"==typeof e.hide?e.hide():$("main > div").hide();var t={person:Person,p_introduction:Person,p_expr:Person,p_edu_expr:Person,p_work_expr:Person,p_skills:Person,p_hobbies:Person,p_contact:Person,s_musics:Musics,s_serials:Serials,w_programs:Projects};if("object"!=typeof t[i])throw new Error("Navigate failed:target object doesn't exited");if("function"!=typeof e.show)throw new Error("Navigate failed:target object haven't show function");e=t[i],e.show();var o=$(this).attr("href");$(o).length>0?($("main").animate({scrollTop:$(o)[0].offsetTop-10},600,"swing"),window.location.hash=o):window.location.hash=""}}),i.length>0&&i.click(),$(window).on("hashchange",function(e){var n=window.location.hash,i=$("nav#menu").find("a:not(.disabled)[href='"+n+"']");i.length>0&&i.click()}),$(window).on("resize",function(){"function"==typeof e.resize&&e.resize()}),$("main").on("scroll",function(){"function"==typeof e.scroll&&e.scroll()}),bindTouch()}function bindTouch(){var e=new Hammer.Manager(window),n=new Hammer.Swipe;e.add(n),e.on("swiperight",function(e){$("nav#menu").data("mmenu").open()}),e.on("swipeleft",function(e){$("nav#menu").data("mmenu").close()})}var Comman=function(e){var n=function(e,n){var n=n||10;return scrollTop=$("main").scrollTop(),scrollHeight=$(e).height()+$(".header").height(),windowHeight=innerHeight,scrollWhole=Math.max(scrollHeight-scrollTop-windowHeight),scrollWhole<n},i=function(e,n,i){var i=i||1.5;return $("main").width()-$(e).width()>i*$(n).width()},t=function(e,t){return n(e)||i(e,t)},o=function(e){return!!(e&&$(e).length>=1)&&$(e).length};return{isScrollOver:n,testSelector:o,isFilled:i,isLoadData:t}}(window),Serials=function(e){function n(e){if("object"!=typeof e)throw new ReferenceError("Init Serials failed, param isn't a object");if(!Comman.testSelector(e.container))throw new ReferenceError("Init Serials failed, container selector doesn't existed or more than one");if(h=e.container,!Comman.testSelector(e.grid))throw new ReferenceError("Init Serials failed, grid selector isn't existed or more than one");g=e.grid,i()}function i(){$(g).on("click",".grid-item",s),$(g).masonry({itemSelector:".grid-item",gutter:10,fitWidth:!0})}function t(e){return"★★★★★★★★★★☆☆☆☆☆☆☆☆☆☆".slice(10-Math.ceil(e),20-Math.round(e))}function o(e){var n={updating:"更新中",end:"完结",schedule:"预定",unknow:"未知"};return n[e]?n[e]:"未知"}function r(e){var n,i,r="";for(i=0,n=e.length;i<n;i++){d=e[i];var a,s,l=d.release_date?"<span class='release_date_item'>("+d.release_date.slice(0,4)+")</span>":"",p="<p class='c_name_item'>"+d.c_name+l+"</p>",m=d.f_name?"<p class='f_name_item'>外文名："+d.f_name+"</p>":"",u=d.director?"<p class='director_item'>导演："+d.director+"</p>":"",f=d.actors?"<p class='acots_item'>演员："+d.actors.split(",").join("/")+"</p>":"",h=d.issuer?"<p class='issuer_item'>发行公司："+d.issuer+"</p>":"",g="",w=d.distinct?"<p class='distinct_item'>地区："+d.distinct+"</p>":"",_=d.state?"<p class='state_item'>状态："+o(d.state)+"</p>":"",v="",$=d.duration?"<p class='duration_html_item'>每集时长："+d.duration+"</p>":"",y=d.episode_number?"<p class='episode_number_item'>集数："+d.episode_number+"</p>":"",b=d.season_number?"<p class='season_number'>季数："+d.season_number+"</p>":"",x=d.reco_index?parseFloat(d.reco_index).toFixed(1):0,S=d.type_index?parseFloat(d.type_index).toFixed(1):0,j=d.douban_index?parseFloat(d.douban_index).toFixed(1):0,P=x>0?"<p class='reco_index_item'>评分："+t(x)+" <span>"+x+"</span></p>":"",E=S>0?"<p class='type_index_item'>类型分："+t(S)+" <span>"+S+"</span></p>":"",M=j>0?"<p class='douban_index_item'>豆瓣评分："+t(j)+" <span>"+j+"</span></p>":"",I=d.synopsis?"<div class='synopsis_item'><p>"+d.synopsis+"</p></div>":"",T=d.posters instanceof Array&&d.posters.length>0?"<img src='"+c+d.posters[Math.floor(Math.random()*d.posters.length)]+"'>":"",R="<p>添加日期："+d.date+"</p>",k=(d.types?d.types.split(","):[],d.tags?d.tags.split(","):[]),C=new Date(d.date),H=new Date,z="";for(a=0,s=k.length;a<s;a++)g+="<a href='./admin/doSerialsAdmin.php'>"+k[a]+"</a>";for(a=0,s=k.length;a<s;a++)v+="<a href='./admin/doSerialsAdmin.php'>"+k[a]+"</a>";g=g?"<div class='types_item'>"+g+"</div>":"",v=v?"<div class='tags_item'>"+v+"</div>":"",d.reco_index&&d.reco_index>=9?z="recommend":H.getTime()-C.getTime()<6048e5&&(z="new_add"),r+="<div class='grid-item "+z+"' data-id='"+d.id+"'><div class='serials_info'>"+T+p+m+u+f+h+w+_+$+y+b+P+E+M+g+v+R+"</div>"+I+"</div>"}return r}function a(){if(!(f||(p-1)*m>=u)&&Comman.isLoadData(g,".grid-item")){f=!0;var e={type:"GET",url:"./admin/doSerialsAdmin.php?act=get&pageSize="+m+"&page="+p++,error:function(e){console.log("页面请求失败...")},success:function(e){var n,i,t=JSON.parse(e),o=t.data;return u=t.total,t.error?void console.log(t.error):(n=r(o),i=$(n),$(g).append(i).masonry("appended",i),f=!1,void $(g).imagesLoaded().progress(function(e,n){n.isLoaded||(n.img.outerHTML="<img>"),$(g).masonry("layout")}).always(function(e){a()}))}};return void $.ajax(e)}}function s(){var e={type:"GET",url:"./admin/doSerialsAdmin.php?act=getImagesById&id="+$(this).attr("data-id"),error:function(e){},success:function(e){var n,i,t=JSON.parse(e),o=t.posters?t.posters:[],r=t.images?t.images:[],a=[];if(t.error)return void console.log(t.error);for(n=0,i=o.length;n<i;n++)a.push({src:c+o[n]});for(n=0,i=r.length;n<i;n++)a.push({src:l+r[n]});$.magnificPopup.open({items:a,gallery:{enabled:!0},type:"image"})}};$.ajax(e)}var c="admin/uploads/posters/",l="admin/uploads/images/",p=1,m=1,u=9999,f=!1,h="",g="";return{init:n,show:function(){$(h).show(),a()},hide:function(){$(h).hide()},scroll:a,resize:a}}(window),Musics=function(e){function n(e){if("object"!=typeof e)throw new ReferenceError("Init Musics failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Musics failed, container selector doesn't existed or more than one");if(d=e.container,"string"!=typeof e.grid||1!==$(e.grid).length)throw new ReferenceError("Init Musics failed, grid selector isn't existed or more than one");c=e.grid,$(c).masonry({itemSelector:".music_item",gutter:10,fitWidth:!0})}function i(){if(!(s||(o-1)*r>=a)&&Comman.isLoadData(c,".music_item")){s=!0;var e={type:"GET",url:"admin/doMusicsAdmin.php?act=get&pageSize="+r+"&page="+o++,error:function(e){console.log("页面请求失败...")},success:function(e){var n,o=JSON.parse(e),r="";a=o.total,o.error&&console.log(o.error),r=t(o.musics),n=$(r),$(c).append(n).masonry("appended",n),$(c).masonry("layout"),s=!1,i()}};$.ajax(e)}}function t(e){var n,i,t='<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling=no height=86 src="http://music.163.com/outchain/player?type={type}&id={id}&auto=0&height=66"></iframe>',o="",r="";for(n=0,i=e.length;n<i;n++)r=t.replace("{type}",e[n].type),r=r.replace("{id}",e[n].m_id),o+="<div class='music_item'><div>"+r+"</div><div class='music_comment'><p>"+e[n].comment+"</p><p class='update_date'>"+e[n].date+"</p></div></div>";return o}var o=1,r=1,a=9999,s=!1,d="",c="";return{init:n,show:function(){console.log("music"),$(d).show(),i()},hide:function(){$(d).hide()},scroll:i,resize:i}}(window),Person=function(e){function n(e){if("object"!=typeof e)throw new ReferenceError("Init Person failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Person failed, container's selector doesn't existed or more than one");o=e.container}function i(){$(o).show()}function t(){$(o).hide()}var o="";return{init:n,show:i,hide:t}}(window),Projects=function(e){var n,i,t,o,r;return t=function(e){if("object"!=typeof e)throw new ReferenceError("Init Project failed, param isn't a object");if("string"!=typeof e.container||1!==$(e.container).length)throw new ReferenceError("Init Project failed, container selector doesn't existed or more than one");if(o=e.container,!Comman.testSelector(e.grid))throw new ReferenceError("Init Project failed, grid selector isn't existed or more than one");r=e.grid,$(".grid").masonry({itemSelector:".grid-item",gutter:10,fitWidth:!0})},n=function(){$(o).show(),$(r).masonry("layout")},i=function(){$(o).hide()},{init:t,show:n,hide:i}}(window);$(window).ready(function(){Serials.init({container:".serials",grid:".serialsCard"}),Musics.init({container:".musics",grid:".music_card"}),Person.init({container:".about_him"}),Projects.init({container:".programs",grid:".grid"}),init()});