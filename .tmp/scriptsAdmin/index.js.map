{"version":3,"sources":["index.js"],"names":["AdminAdd","init","AdminSerials","Show","AdminServer","show","$","attr","css","on","event","preventDefault","stopPropagation","ajax","url","success","response","res","JSON","parse","beLogout","beLogin","nav_id","hide","nav","AdminMovies","AdminAnimations","AdminMusics","AdminBooks","AdminUpdate","Error","cls","data","magnificPopup","open","items","src","type","serialize","alert","close","bindTouch","text","username","user","Cookies","get","mc","Hammer","Manager","window","Swipe","add","e"],"mappings":";;;;AAAA;;;;AAIAA,SAASC,IAAT;AACAC,aAAaD,IAAb;;AAEAA;;AAEA,SAASA,IAAT,GAAe;AACX;AACA,QAAIE,OAAOC,WAAX;AACAD,SAAKE,IAAL;;AAEA;AACAC,MAAE,WAAF,EAAeC,IAAf,CAAoB,OAApB,EAA6B,OAA7B,EAAsCC,GAAtC,CAA0C,EAAC,SAAQ,kBAAT,EAA4B,UAAS,SAArC,EAA1C,EAA2FC,EAA3F,CAA8F,OAA9F,EAAsG,UAASC,KAAT,EAAe;AACjHA,cAAMC,cAAN;AACAD,cAAME,eAAN;AACH,KAHD;;AAKA;AACAN,MAAEO,IAAF,CAAO;AACHC,aAAK,8BADF;AAEHC,iBAAQ,iBAASC,QAAT,EAAkB;AACtB,gBAAIC,MAAMC,KAAKC,KAAL,CAAWH,QAAX,CAAV;AACA,gBAAGC,IAAI,UAAJ,CAAH,EAAoB;AAChBG,yBAASH,IAAI,UAAJ,CAAT;AACH,aAFD,MAEO;AACHI;AACH;AACJ;AATE,KAAP;;AAYA;AACAf,MAAE,KAAF,EAASG,EAAT,CAAY,OAAZ,EAAoB,GAApB,EAAyB,UAASC,KAAT,EAAe;AACpC,YAAIY,SAAShB,EAAE,IAAF,EAAQC,IAAR,CAAa,IAAb,CAAb;;AAEA;AACA,YAAG,CAACe,MAAJ,EAAW;AACP;AACH;AACDZ,cAAMC,cAAN;;AAEA;AACA,YAAGR,QAAQ,OAAOA,KAAKoB,IAAZ,KAAqB,UAAhC,EAA2C;AACvCpB,iBAAKoB,IAAL;AACH,SAFD,MAEO;AACHjB,cAAE,YAAF,EAAgBiB,IAAhB;AACH;;AAED;AACA,YAAIC,MAAM;AACN,sBAAUpB,WADJ;AAEN,2BAAeqB,WAFT;AAGN,4BAAgBvB,YAHV;AAIN,+BAAmBwB,eAJb;AAKN,2BAAeC,WALT;AAMN,0BAAcC,UANR;AAON,6BAAiBC,WAPX;AAQN,wBAAY7B,QARN;AASN,8BAAkB6B;AATZ,SAAV;;AAaA,YAAG,QAAOL,IAAIF,MAAJ,CAAP,MAAuB,QAA1B,EAAmC;AAC/B,kBAAM,IAAIQ,KAAJ,CAAU,8CAAV,CAAN;AACA;AACH;;AAED,YAAG,OAAON,IAAIF,MAAJ,EAAYjB,IAAnB,KAA4B,UAA/B,EAA2C;AACvC,kBAAM,IAAIyB,KAAJ,CAAU,qDAAV,CAAN;AACA;AACH;;AAED;AACA3B,eAAOqB,IAAIF,MAAJ,CAAP;AACAnB,aAAKE,IAAL;AACH,KA3CD;;AA6CA;AACAC,MAAE,SAAF,EAAaG,EAAb,CAAgB,OAAhB,EAAyB,GAAzB,EAA8B,UAASC,KAAT,EAAgB;AAC1CA,cAAMC,cAAN;AACA,YAAIoB,MAAMzB,EAAE,IAAF,EAAQC,IAAR,CAAa,OAAb,CAAV;;AAEA;AACA,YAAIwB,OAAO,QAAX,EAAqB;AACjBzB,cAAEO,IAAF,CAAO;AACHC,qBAAK,+BADF;AAEHC,yBAAS,iBAAUiB,IAAV,EAAgB;AACrB,wBAAId,KAAKC,KAAL,CAAWa,IAAX,EAAiB,SAAjB,KAA+B,IAAnC,EAAyC;AACrCX;AACH;AACJ;AANE,aAAP;AAQH;;AAED;AACA,YAAIU,OAAO,OAAX,EAAoB;AAChBzB,cAAE2B,aAAF,CAAgBC,IAAhB,CAAqB;AACjBC,uBAAO;AACHC,yBAAK,uDACL,iEADK,GAEL,oEAFK,GAGL,yDAHK,GAIL,2EALG;AAMHC,0BAAM;AANH;AADU,aAArB;AAUH;AACJ,KA7BD;;AA+BA;AACA;AACA/B,MAAE,MAAF,EAAUG,EAAV,CAAa,QAAb,EAAsB,aAAtB,EAAqC,UAASC,KAAT,EAAe;AAChDA,cAAMC,cAAN;AACAL,UAAEO,IAAF,CAAO;AACHC,iBAAK,8BADF;AAEHkB,kBAAK1B,EAAE,aAAF,EAAiBgC,SAAjB,EAFF;AAGHD,kBAAK,MAHF;AAIHtB,qBAAS,iBAAUC,QAAV,EAAoB;AACzB,oBAAIC,MAAMC,KAAKC,KAAL,CAAWH,QAAX,CAAV;AACA,oBAAGC,IAAI,OAAJ,CAAH,EAAgB;AACZsB,0BAAMtB,IAAI,OAAJ,CAAN;AACH;AACD,oBAAGA,IAAI,UAAJ,CAAH,EAAoB;AAChBG,6BAASH,IAAI,UAAJ,CAAT;AACAsB,0BAAM,OAAOtB,IAAI,UAAJ,CAAP,GAAyB,SAA/B;AACAX,sBAAE2B,aAAF,CAAgBO,KAAhB;AACH;AACJ;AAdE,SAAP;AAgBH,KAlBD;;AAoBA;AACAC;;AAEA;;;AAGA,aAASpB,OAAT,GAAkB;AACdf,UAAE,SAAF,EAAaC,IAAb,CAAkB,OAAlB,EAA2B,OAA3B,EAAoCmC,IAApC,CAAyC,SAAzC;AACApC,UAAE,YAAF,EAAgBoC,IAAhB,CAAqB,OAArB;AACH;;AAED;;;AAGA,aAAStB,QAAT,CAAkBuB,QAAlB,EAA2B;AACvB,YAAIC,OAAOD,YAAYE,QAAQC,GAAR,CAAY,WAAZ,CAAZ,IAAwC,EAAnD;AACA,YAAGF,SAAS,EAAZ,EAAe;AACXvB;AACH,SAFD,MAEO;AACHf,cAAE,QAAF,EAAYC,IAAZ,CAAiB,OAAjB,EAA0B,QAA1B,EAAoCmC,IAApC,CAAyC,UAAzC;AACApC,cAAE,YAAF,EAAgBoC,IAAhB,CAAqBE,IAArB;AACH;AACJ;AACJ;;AAED,SAASH,SAAT,GAAoB;AAChB;AACA,QAAIM,KAAK,IAAIC,OAAOC,OAAX,CAAmBC,MAAnB,CAAT;;AAEA;AACA,QAAIC,QAAQ,IAAIH,OAAOG,KAAX,EAAZ;;AAEA;AACAJ,OAAGK,GAAH,CAAOD,KAAP;;AAEA;AACAJ,OAAGtC,EAAH,CAAM,YAAN,EAAoB,UAAS4C,CAAT,EAAY;AAC5B/C,UAAE,UAAF,EAAc0B,IAAd,CAAoB,OAApB,EAA8BE,IAA9B;AACH,KAFD;AAGAa,OAAGtC,EAAH,CAAM,WAAN,EAAmB,UAAS4C,CAAT,EAAY;AAC3B/C,UAAE,UAAF,EAAc0B,IAAd,CAAoB,OAApB,EAA8BQ,KAA9B;AACH,KAFD;AAGH","file":"index.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/8/30.\r\n */\r\n\r\nAdminAdd.init();\r\nAdminSerials.init();\r\n\r\ninit();\r\n\r\nfunction init(){\r\n    // 初始页面为显示服务器信息\r\n    var Show = AdminServer;\r\n    Show.show();\r\n\r\n    // 未开放的功能置为不可用状态\r\n    $(\".disabled\").attr(\"title\", \"功能未上线\").css({\"color\":\"rgba(0,0,0,0.34)\",\"cursor\":\"default\"}).on(\"click\",function(event){\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    });\r\n\r\n    // 初始化登录状态\r\n    $.ajax({\r\n        url: \"doSerialsAdmin.php?act=login\",\r\n        success:function(response){\r\n            var res = JSON.parse(response);\r\n            if(res[\"username\"]) {\r\n                beLogout(res[\"username\"]);\r\n            } else {\r\n                beLogin();\r\n            }\r\n        }\r\n    })\r\n\r\n    // 监听导航事件\r\n    $('nav').on(\"click\",'a', function(event){\r\n        var nav_id = $(this).attr(\"id\");\r\n\r\n        // 默认有效的导航项需设置id，没有id的项为导航插件自动添加的项目或自定义链接。\r\n        if(!nav_id){\r\n            return;\r\n        }\r\n        event.preventDefault();\r\n\r\n        // 调用页面对象的隐藏函数\r\n        if(Show && typeof Show.hide === \"function\"){\r\n            Show.hide();\r\n        } else {\r\n            $(\"main > div\").hide();\r\n        }\r\n\r\n        // 导航项对应的页面对象\r\n        var nav = {\r\n            \"server\": AdminServer,\r\n            \"list_movies\": AdminMovies,\r\n            \"list_serials\": AdminSerials,\r\n            \"list_animations\": AdminAnimations,\r\n            \"list_musics\": AdminMusics,\r\n            \"list_books\": AdminBooks,\r\n            \"update_movies\": AdminUpdate,\r\n            \"add_item\": AdminAdd,\r\n            \"update_serials\": AdminUpdate\r\n        }\r\n\r\n\r\n        if(typeof nav[nav_id] !== \"object\"){\r\n            throw new Error(\"Navigate failed:target object doesn't exited\");\r\n            return;\r\n        }\r\n\r\n        if(typeof nav[nav_id].show !== \"function\") {\r\n            throw new Error(\"Navigate failed:target object haven't show function\");\r\n            return;\r\n        }\r\n\r\n        // 调用页面对象的显示函数\r\n        Show = nav[nav_id];\r\n        Show.show();\r\n    });\r\n\r\n    // 监听登录、登出事件\r\n    $(\".header\").on(\"click\", \"a\", function(event) {\r\n        event.preventDefault();\r\n        var cls = $(this).attr(\"class\");\r\n\r\n        // 登出\r\n        if (cls == \"logout\") {\r\n            $.ajax({\r\n                url: \"doSerialsAdmin.php?act=logout\",\r\n                success: function (data) {\r\n                    if (JSON.parse(data)[\"success\"] == true) {\r\n                        beLogin();\r\n                    }\r\n                }\r\n            })\r\n        }\r\n\r\n        // 登入\r\n        if (cls == \"login\") {\r\n            $.magnificPopup.open({\r\n                items: {\r\n                    src: \"<div class='white-popup'><form class='loginPanel'>\" +\r\n                    \"<input type='text' name='username'  placeholder='Username'><br>\" +\r\n                    \"<input type='password' name='password' placeholder='Password'><br>\" +\r\n                    \"<input type='checkbox' id='autoLogin' name='autoLogin'>\" +\r\n                    \"<label for='autoLogin'>一周内免登录</label><br><button>登录</button></form></div>\",\r\n                    type: 'inline'\r\n                }\r\n            })\r\n        }\r\n    })\r\n\r\n    // 监听登录窗提交事件\r\n    // todo:表单验证\r\n    $(\"body\").on(\"submit\",\".loginPanel\", function(event){\r\n        event.preventDefault();\r\n        $.ajax({\r\n            url: \"doSerialsAdmin.php?act=login\",\r\n            data:$(\".loginPanel\").serialize(),\r\n            type:'post',\r\n            success: function (response) {\r\n                var res = JSON.parse(response);\r\n                if(res[\"error\"]){\r\n                    alert(res[\"error\"]);\r\n                }\r\n                if(res[\"username\"]) {\r\n                    beLogout(res[\"username\"]);\r\n                    alert(\"二货\" + res[\"username\"] + \"，开始干活了！\")\r\n                    $.magnificPopup.close();\r\n                }\r\n            }\r\n        })\r\n    });\r\n\r\n    // 监听触摸事件\r\n    bindTouch();\r\n\r\n    /**\r\n     * 登录状态变为未登录\r\n     */\r\n    function beLogin(){\r\n        $(\".logout\").attr(\"class\", \"login\").text(\"Sign in\")\r\n        $(\".log_state\").text(\"游客您好！\");\r\n    }\r\n\r\n    /**\r\n     * 登录状态变为已登录\r\n     */\r\n    function beLogout(username){\r\n        var user = username || Cookies.get(\"adminName\") || \"\";\r\n        if(user === \"\"){\r\n            beLogin();\r\n        } else {\r\n            $(\".login\").attr(\"class\", \"logout\").text(\"Sign out\");\r\n            $(\".log_state\").text(user);\r\n        }\r\n    }\r\n}\r\n\r\nfunction bindTouch(){\r\n    // create a manager for that element\r\n    var mc = new Hammer.Manager(window);\r\n\r\n    // create a recognizer\r\n    var Swipe = new Hammer.Swipe();\r\n\r\n    // add the recognizer\r\n    mc.add(Swipe);\r\n\r\n    // subscribe to events\r\n    mc.on('swiperight', function(e) {\r\n        $('nav#menu').data( 'mmenu' ).open();\r\n    });\r\n    mc.on('swipeleft', function(e) {\r\n        $('nav#menu').data( 'mmenu' ).close();\r\n    });\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}