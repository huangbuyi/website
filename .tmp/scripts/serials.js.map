{"version":3,"sources":["serials.js"],"names":["Serials","window","POSTERS_PATH","IMAGES_PATH","page","pageSize","total","curr_id","hasScrolled","containerSelector","gridSelector","init","o","ReferenceError","Comman","testSelector","container","grid","bind","$","on","lightBox","masonry","itemSelector","gutter","fitWidth","hide","createStars","index","slice","Math","ceil","round","createStateCN","state","stateCN","createHtml","data","html","len","i","length","d","release_date_html","c_name_html","f_name_html","director_html","acots_html","split","join","issuer_html","types_html","distinct_html","state_html","tags_html","duration_html","episode_number_html","season_number_html","reco_index","parseFloat","toFixed","type_index","douban_index","reco_index_html","type_index_html","douban_index_html","synopsis_html","poster_html","Array","floor","random","date_html","types","tags","addDate","Date","now","banner","j","tagsLen","getTime","loadData","isScrollOver","options","type","url","error","request","console","log","success","response","res","JSON","parse","$items","append","imagesLoaded","progress","instance","image","isLoaded","img","outerHTML","always","ajax","attr","posters","images","items","push","src","magnificPopup","open","gallery","enabled","show","scroll","resize"],"mappings":";;;;AAAA;;;;AAKA,IAAIA,UAAW,UAASC,MAAT,EAAgB;AAC3B,QAAIC,eAAe,wBAAnB;AAAA,QACIC,cAAc,uBADlB;;AAGA,QAAIC,OAAO,CAAX;AAAA,QACIC,WAAW,CADf;AAAA,QAEIC,QAAQ,IAFZ;AAAA,QAGIC,UAAU,CAHd;AAAA,QAIIC,cAAc,KAJlB;AAAA,QAKIC,oBAAoB,EALxB;AAAA,QAMIC,eAAe,EANnB;;AASA,aAASC,IAAT,CAAcC,CAAd,EAAgB;AACZ,YAAG,QAAOA,CAAP,yCAAOA,CAAP,OAAa,QAAhB,EAAyB;AACrB,kBAAM,IAAIC,cAAJ,CAAmB,4CAAnB,CAAN;AACA;AACH;;AAED,YAAIC,OAAOC,YAAP,CAAoBH,EAAEI,SAAtB,CAAJ,EAAqC;AACjCP,gCAAoBG,EAAEI,SAAtB;AACH,SAFD,MAEO;AACH,kBAAM,IAAIH,cAAJ,CAAmB,2EAAnB,CAAN;AACA;AACH;;AAED,YAAIC,OAAOC,YAAP,CAAoBH,EAAEK,IAAtB,CAAJ,EAAiC;AAC7BP,2BAAeE,EAAEK,IAAjB;AACH,SAFD,MAEO;AACH,kBAAM,IAAIJ,cAAJ,CAAmB,oEAAnB,CAAN;AACA;AACH;;AAEDK;AACH;;AAED,aAASA,IAAT,GAAe;AACXC,UAAET,YAAF,EAAgBU,EAAhB,CAAmB,OAAnB,EAA2B,YAA3B,EAAwCC,QAAxC;AACAF,UAAET,YAAF,EAAgBY,OAAhB,CAAwB;AACpBC,0BAAc,YADM;AAEpBC,oBAAQ,EAFY;AAGpBC,sBAAU;AAHU,SAAxB;AAKAN,UAAE,cAAF,EAAkBC,EAAlB,CAAqB,OAArB,EAA6B,YAA7B,EAA0C,YAAY;AAClDD,cAAE,IAAF,EAAQO,IAAR;AACAP,cAAET,YAAF,EAAgBY,OAAhB,CAAwB,QAAxB;AACH,SAHD;AAIH;;AAGD;;;AAGA,aAASK,WAAT,CAAqBC,KAArB,EAA4B;AACxB,eAAO,uBAAuBC,KAAvB,CAA6B,KAAKC,KAAKC,IAAL,CAAUH,KAAV,CAAlC,EAAoD,KAAKE,KAAKE,KAAL,CAAWJ,KAAX,CAAzD,CAAP;AACH;;AAED;;;AAGA,aAASK,aAAT,CAAuBC,KAAvB,EAA6B;AACzB,YAAIC,UAAU,EAAC,YAAW,KAAZ,EAAkB,OAAM,IAAxB,EAA6B,YAAW,IAAxC,EAA6C,UAAS,IAAtD,EAAd;AACA,eAAOA,QAAQD,KAAR,IAAiBC,QAAQD,KAAR,CAAjB,GAAkC,IAAzC;AACH;;AAGD;;;;;AAKA,aAASE,UAAT,CAAoBC,IAApB,EAAyB;AACrB,YAAIC,OAAO,EAAX;AAAA,YACIC,GADJ;AAAA,YACSC,CADT;;AAGA,aAAIA,IAAI,CAAJ,EAAOD,MAAMF,KAAKI,MAAtB,EAA8BD,IAAID,GAAlC,EAAuCC,GAAvC,EAA2C;AACvCE,gBAAIL,KAAKG,CAAL,CAAJ;AACA,gBAAI;AACAG,gCAAoBD,EAAE,cAAF,IAAoB,wCAAwCA,EAAE,cAAF,EAAkBb,KAAlB,CAAwB,CAAxB,EAA0B,CAA1B,CAAxC,GAAuE,UAA3F,GAAsG,EAD9H;;AAEI;AACAe,0BAAc,8BAA8BF,EAAE,QAAF,CAA9B,GAA4CC,iBAA5C,GAAgE,MAHlF;;AAII;AACAE,0BAAcH,EAAE,QAAF,IAAc,kCAAkCA,EAAE,QAAF,CAAlC,GAAgD,MAA9D,GAAuE,EALzF;;AAMI;AACAI,4BAAgBJ,EAAE,UAAF,IAAgB,mCAAmCA,EAAE,UAAF,CAAnC,GAAmD,MAAnE,GAA4E,EAPhG;;AAQI;AACAK,yBAAaL,EAAE,QAAF,IAAc,gCAAgCA,EAAE,QAAF,EAAYM,KAAZ,CAAkB,GAAlB,EAAuBC,IAAvB,CAA4B,GAA5B,CAAhC,GAAmE,MAAjF,GAA0F,EAT3G;;AAUI;AACAC,0BAAcR,EAAE,QAAF,IAAc,mCAAmCA,EAAE,QAAF,CAAnC,GAAiD,MAA/D,GAAsE,EAXxF;;AAYI;AACAS,yBAAa,EAbjB;;AAcI;AACAC,4BAAgBV,EAAE,UAAF,IAAgB,mCAAmCA,EAAE,UAAF,CAAnC,GAAmD,MAAnE,GAA0E,EAf9F;;AAgBI;AACAW,yBAAaX,EAAE,OAAF,IAAa,gCAAgCT,cAAcS,EAAE,OAAF,CAAd,CAAhC,GAA4D,MAAzE,GAAgF,EAjBjG;AAAA,gBAkBIY,YAAY,EAlBhB;;AAmBI;AACAC,4BAAgBb,EAAE,UAAF,IAAgB,0CAA0CA,EAAE,UAAF,CAA1C,GAA0D,MAA1E,GAAiF,EApBrG;;AAqBI;AACAc,kCAAsBd,EAAE,gBAAF,IAAsB,yCAAyCA,EAAE,gBAAF,CAAzC,GAA+D,MAArF,GAA4F,EAtBtH;;AAuBI;AACAe,iCAAqBf,EAAE,eAAF,IAAqB,mCAAmCA,EAAE,eAAF,CAAnC,GAAwD,MAA7E,GAAoF,EAxB7G;AAAA,gBA0BIgB,aAAahB,EAAE,YAAF,IAAkBiB,WAAYjB,EAAE,YAAF,CAAZ,EAA8BkB,OAA9B,CAAsC,CAAtC,CAAlB,GAA2D,CA1B5E;AAAA,gBA2BIC,aAAanB,EAAE,YAAF,IAAkBiB,WAAYjB,EAAE,YAAF,CAAZ,EAA8BkB,OAA9B,CAAsC,CAAtC,CAAlB,GAA2D,CA3B5E;AAAA,gBA4BIE,eAAcpB,EAAE,cAAF,IAAqBiB,WAAYjB,EAAE,cAAF,CAAZ,EAAgCkB,OAAhC,CAAwC,CAAxC,CAArB,GAAgE,CA5BlF;;;AA8BI;AACAG,8BAAkBL,aAAa,CAAb,GAAiB,qCAAqC/B,YAAY+B,UAAZ,CAArC,GAA+D,SAA/D,GAA4EA,UAA5E,GAAyF,aAA1G,GAAwH,EA/B9I;;AAgCI;AACAM,8BAAkBH,aAAa,CAAb,GAAiB,sCAAuClC,YAAYkC,UAAZ,CAAvC,GAAiE,SAAjE,GAA8EA,UAA9E,GAA2F,aAA5G,GAA0H,EAjChJ;;AAkCI;AACAI,gCAAoBH,eAAe,CAAf,GAAmB,yCAA0CnC,YAAYmC,YAAZ,CAA1C,GAAsE,SAAtE,GAAmFA,YAAnF,GAAkG,aAArH,GAAmI,EAnC3J;;AAoCI;AACAI,4BAAgBxB,EAAE,UAAF,IAAgB,qCAAqCA,EAAE,UAAF,CAArC,GAAqD,YAArE,GAAkF,EArCtG;;AAsCI;AACAyB,0BAAezB,EAAE,SAAF,aAAwB0B,KAAxB,IAAiC1B,EAAE,SAAF,EAAaD,MAAb,GAAsB,CAAxD,GAA6D,gBAAgBvC,YAAhB,GAA+BwC,EAAE,SAAF,EAAcZ,KAAKuC,KAAL,CAAWvC,KAAKwC,MAAL,KAAgB5B,EAAE,SAAF,EAAaD,MAAxC,CAAd,CAA/B,GAAiG,KAA9J,GAAqK,EAvCvL;AAAA,gBAyCI8B,YAAY,aAAa7B,EAAE,MAAF,CAAb,GAAyB,MAzCzC;AAAA,gBA2CI8B,QAAQ9B,EAAE,OAAF,IAAaA,EAAE,OAAF,EAAWM,KAAX,CAAiB,GAAjB,CAAb,GAAmC,EA3C/C;AAAA,gBA4CIyB,OAAO/B,EAAE,MAAF,IAAYA,EAAE,MAAF,EAAUM,KAAV,CAAgB,GAAhB,CAAZ,GAAiC,EA5C5C;AAAA,gBA8CI0B,UAAU,IAAIC,IAAJ,CAASjC,EAAE,MAAF,CAAT,CA9Cd;AAAA,gBA+CIkC,MAAM,IAAID,IAAJ,EA/CV;AAAA,gBAgDIE,SAAO,EAhDX;AAAA,gBAgDeC,CAhDf;AAAA,gBAgDkBC,OAhDlB;;AAkDA,iBAAID,IAAI,CAAJ,EAAOC,UAAUN,KAAKhC,MAA1B,EAAkCqC,IAAIC,OAAtC,EAA+CD,GAA/C,EAAmD;AAC/C3B,8BAAc,4CAA4CsB,KAAKK,CAAL,CAA5C,GAAsD,MAApE;AACH;AACD,iBAAIA,IAAI,CAAJ,EAAOC,UAAUN,KAAKhC,MAA1B,EAAkCqC,IAAIC,OAAtC,EAA+CD,GAA/C,EAAmD;AAC/CxB,6BAAa,4CAA4CmB,KAAKK,CAAL,CAA5C,GAAsD,MAAnE;AACH;;AAED3B,yBAAaA,aAAa,+BAA+BA,UAA/B,GAA4C,QAAzD,GAAmE,EAAhF;AACAG,wBAAYA,YAAY,8BAA8BA,SAA9B,GAA0C,QAAtD,GAA+D,EAA3E;;AAEA;AACA,gBAAGZ,EAAE,YAAF,KAAmBA,EAAE,YAAF,KAAmB,GAAzC,EAA6C;AACzCmC,yBAAS,WAAT;AACH,aAFD,MAEO,IAAKD,IAAII,OAAJ,KAAgBN,QAAQM,OAAR,EAAjB,GAAsC,OAAK,IAAL,GAAU,EAAV,GAAa,CAAvD,EAA0D;AAC7DH,yBAAS,SAAT;AACH;;AAGDvC,oBAAQ,4BAA4BuC,MAA5B,GAAqC,eAArC,GAAuDnC,EAAE,IAAF,CAAvD,GAAiE,iCAAjE,GAAqGyB,WAArG,GACJvB,WADI,GACUC,WADV,GACwBC,aADxB,GACwCC,UADxC,GACqDG,WADrD,GACmEE,aADnE,GAEJC,UAFI,GAESE,aAFT,GAEyBC,mBAFzB,GAE+CC,kBAF/C,GAEoEM,eAFpE,GAGJC,eAHI,GAGcC,iBAHd,GAGkCd,UAHlC,GAG+CG,SAH/C,GAG2DiB,SAH3D,GAGuE,QAHvE,GAGkFL,aAHlF,GAIJ,QAJJ;AAKH;AACD,eAAO5B,IAAP;AACH;;AAID;;;AAGA;AACA;AACA;AACA,aAAS2C,QAAT,GAAmB;AACf;AACA,YAAIzE,eAAgB,CAACJ,OAAO,CAAR,IAAaC,QAAd,IAA4BC,KAA/C,EAAqD;AACjD;AACH;;AAED;AACA,YAAGQ,OAAOoE,YAAP,CAAoBxE,YAApB,CAAH,EAAqC;AACjCF,0BAAc,IAAd,CADiC,CACT;;AAExB;AACA,gBAAI2E,UAAU;AACVC,sBAAM,KADI;AAEVC,qBAAK,iDAAiDhF,QAAjD,GAA4D,QAA5D,GAAwED,MAFnE;AAGVkF,uBAAO,eAAUC,OAAV,EAAmB;AACtBC,4BAAQC,GAAR,CAAY,WAAZ;AACH,iBALS;AAMVC,yBAAS,iBAAUC,QAAV,EAAoB;;AAEzB,wBAAIC,MAAMC,KAAKC,KAAL,CAAWH,QAAX,CAAV;AAAA,wBACIjD,IAAIkD,IAAI,MAAJ,CADR;AAAA,wBAEItD,IAFJ;AAAA,wBAEUyD,MAFV;;AAIAzF,4BAAQsF,IAAI,OAAJ,CAAR;AACA,wBAAIA,IAAI,OAAJ,CAAJ,EAAkB;AACdJ,gCAAQC,GAAR,CAAYG,IAAI,OAAJ,CAAZ;AACA;AACH;;AAED;AACAtD,2BAAOF,WAAWM,CAAX,CAAP;AACAqD,6BAAS5E,EAAEmB,IAAF,CAAT;;AAEA;AACAnB,sBAAET,YAAF,EAAgBsF,MAAhB,CAAuBD,MAAvB,EAA+BzE,OAA/B,CAAuC,UAAvC,EAAmDyE,MAAnD;AACD;;AAEC;AACAvF,kCAAc,KAAd;;AAEA;AACAW,sBAAET,YAAF,EAAgBuF,YAAhB,GAA+BC,QAA/B,CAAyC,UAASC,QAAT,EAAmBC,KAAnB,EAA0B;;AAE/D;AACA,4BAAG,CAACA,MAAMC,QAAV,EAAmB;AACfD,kCAAME,GAAN,CAAUC,SAAV,GAAsB,OAAtB;AACH;;AAED;AACApF,0BAAET,YAAF,EAAgBY,OAAhB,CAAwB,QAAxB;AACH,qBATD,EASGkF,MATH,CASW,UAAUL,QAAV,EAAqB;;AAE5B;AACAlB;AACH,qBAbD;AAcH;AA5CS,aAAd;AA8CA9D,cAAEsF,IAAF,CAAOtB,OAAP;;AAGA;AACA;AACH;AACJ;;AAED;AACA,aAAS9D,QAAT,GAAmB;;AAEf;AACA,YAAI8D,UAAU;AACVC,kBAAM,KADI;AAEVC,iBAAK,qDAAqDlE,EAAE,IAAF,EAAQuF,IAAR,CAAa,SAAb,CAFhD;AAGVpB,mBAAO,eAAUC,OAAV,EAAmB;AACtB;AACH,aALS;AAMVG,qBAAS,iBAAUC,QAAV,EAAoB;AACzB,oBAAIC,MAAMC,KAAKC,KAAL,CAAWH,QAAX,CAAV;AAAA,oBACIgB,UAAUf,IAAI,SAAJ,IAAiBA,IAAI,SAAJ,CAAjB,GAAkC,EADhD;AAAA,oBAEIgB,SAAShB,IAAI,QAAJ,IAAgBA,IAAI,QAAJ,CAAhB,GAAgC,EAF7C;AAAA,oBAGIiB,QAAQ,EAHZ;AAAA,oBAIIrE,CAJJ;AAAA,oBAIMD,GAJN;;AAMA,oBAAIqD,IAAI,OAAJ,CAAJ,EAAkB;AACdJ,4BAAQC,GAAR,CAAYG,IAAI,OAAJ,CAAZ;AACA;AACH;;AAED;AACA,qBAAIpD,IAAI,CAAJ,EAAOD,MAAMoE,QAAQlE,MAAzB,EAAiCD,IAAID,GAArC,EAA0CC,GAA1C,EAA8C;AAC1CqE,0BAAMC,IAAN,CAAW;AACPC,6BAAK7G,eAAeyG,QAAQnE,CAAR;AADb,qBAAX;AAGH;AACD,qBAAIA,IAAI,CAAJ,EAAOD,MAAMqE,OAAOnE,MAAxB,EAAgCD,IAAID,GAApC,EAAyCC,GAAzC,EAA6C;AACzCqE,0BAAMC,IAAN,CAAW;AACPC,6BAAK5G,cAAcyG,OAAOpE,CAAP;AADZ,qBAAX;AAGH;;AAED;AACArB,kBAAE6F,aAAF,CAAgBC,IAAhB,CAAqB;AACjBJ,2BAAMA,KADW;AAEjBK,6BAAS;AACLC,iCAAS,IADJ,CACW;AADX,qBAFQ;AAKjB/B,0BAAK;AALY,iBAArB;AAQH;AAvCS,SAAd;AAyCAjE,UAAEsF,IAAF,CAAOtB,OAAP;AAEH;;AAGD,WAAO;AACHxE,cAAKA,IADF;AAEHyG,cAAK,gBAAU;AACXjG,cAAEV,iBAAF,EAAqB2G,IAArB;AACAnC;AACH,SALE;AAMHvD,cAAK,gBAAU;AACXP,cAAEV,iBAAF,EAAqBiB,IAArB;AACH,SARE;AASH2F,gBAAOpC,QATJ;AAUHqC,gBAAOrC;AAVJ,KAAP;AAcH,CAnSc,CAmSbhF,MAnSa,CAAf","file":"serials.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/3.\r\n */\r\n\r\n\r\nvar Serials = (function(window){\r\n    var POSTERS_PATH = 'admin/uploads/posters/',\r\n        IMAGES_PATH = 'admin/uploads/images/';\r\n\r\n    var page = 1,\r\n        pageSize = 1,\r\n        total = 9999,\r\n        curr_id = 0,\r\n        hasScrolled = false,\r\n        containerSelector = '',\r\n        gridSelector = '';\r\n\r\n\r\n    function init(o){\r\n        if(typeof o !== 'object'){\r\n            throw new ReferenceError('Init Serials failed, param isn\\'t a object');\r\n            return;\r\n        }\r\n\r\n        if( Comman.testSelector(o.container)){\r\n            containerSelector = o.container;\r\n        } else {\r\n            throw new ReferenceError('Init Serials failed, container selector doesn\\'t existed or more than one')\r\n            return;\r\n        }\r\n\r\n        if( Comman.testSelector(o.grid) ){\r\n            gridSelector = o.grid;\r\n        } else {\r\n            throw new ReferenceError('Init Serials failed, grid selector isn\\'t existed or more than one');\r\n            return;\r\n        }\r\n\r\n        bind();\r\n    }\r\n\r\n    function bind(){\r\n        $(gridSelector).on('click','.grid-item',lightBox);\r\n        $(gridSelector).masonry({\r\n            itemSelector: '.grid-item',\r\n            gutter: 10,\r\n            fitWidth: true\r\n        })\r\n        $('.serialsCard').on('click','.grid-item',function () {\r\n            $(this).hide();\r\n            $(gridSelector).masonry('layout');\r\n        })\r\n    }\r\n\r\n\r\n    /**\r\n     * 显示分数为星星\r\n     */\r\n    function createStars(index) {\r\n        return '★★★★★★★★★★☆☆☆☆☆☆☆☆☆☆'.slice(10 - Math.ceil(index), 20 - Math.round(index));\r\n    }\r\n\r\n    /**\r\n     * 将状态英文转为中文\r\n     */\r\n    function createStateCN(state){\r\n        var stateCN = {'updating':'更新中','end':'完结','schedule':'预定','unknow':'未知'};\r\n        return stateCN[state] ? stateCN[state] : '未知';\r\n    }\r\n\r\n\r\n    /**\r\n     *将电视剧数据转化为html代码\r\n     * @param data 电视剧数据，约定为数组\r\n     * @returns {string} html代码\r\n     */\r\n    function createHtml(data){\r\n        var html = '',\r\n            len, i;\r\n\r\n        for(i = 0, len = data.length; i < len; i++){\r\n            d = data[i];\r\n            var // 发行日期\r\n                release_date_html = d['release_date'] ? '<span class=\\'release_date_item\\'>(' + d['release_date'].slice(0,4) + ')</span>':'',\r\n                // 中文名\r\n                c_name_html = '<p class=\\'c_name_item\\'>' + d['c_name'] + release_date_html + '</p>',\r\n                // 外文名\r\n                f_name_html = d['f_name'] ? '<p class=\\'f_name_item\\'>外文名：' + d['f_name'] + '</p>' : '',\r\n                // 导演\r\n                director_html = d['director'] ? '<p class=\\'director_item\\'>导演：' + d['director'] + '</p>' : '',\r\n                // 演员\r\n                acots_html = d['actors'] ? '<p class=\\'acots_item\\'>演员：' + d['actors'].split(',').join('/') + '</p>' : '',\r\n                // 发行公司\r\n                issuer_html = d['issuer'] ? '<p class=\\'issuer_item\\'>发行公司：' + d['issuer'] + '</p>':'',\r\n                // 类型\r\n                types_html = '',\r\n                // 地区\r\n                distinct_html = d['distinct'] ? '<p class=\\'distinct_item\\'>地区：' + d['distinct'] + '</p>':'',\r\n                // 状态\r\n                state_html = d['state'] ? '<p class=\\'state_item\\'>状态：' + createStateCN(d['state']) + '</p>':'',\r\n                tags_html = '',\r\n                // 时长\r\n                duration_html = d['duration'] ? '<p class=\\'duration_html_item\\'>每集时长：' + d['duration'] + '</p>':'',\r\n                // 集数\r\n                episode_number_html = d['episode_number'] ? '<p class=\\'episode_number_item\\'>集数：' + d['episode_number'] + '</p>':'',\r\n                // 季数\r\n                season_number_html = d['season_number'] ? '<p class=\\'season_number\\'>季数：' + d['season_number'] + '</p>':'',\r\n\r\n                reco_index = d['reco_index'] ? parseFloat( d['reco_index'] ).toFixed(1):0,\r\n                type_index = d['type_index'] ? parseFloat( d['type_index'] ).toFixed(1):0,\r\n                douban_index =d['douban_index'] ?  parseFloat( d['douban_index'] ).toFixed(1):0,\r\n\r\n                // 推荐评分\r\n                reco_index_html = reco_index > 0 ? '<p class=\\'reco_index_item\\'>评分：' + createStars(reco_index) + ' <span>'  + reco_index + '</span></p>':'',\r\n                // 类型评分\r\n                type_index_html = type_index > 0 ? '<p class=\\'type_index_item\\'>类型分：' +  createStars(type_index) + ' <span>'  + type_index + '</span></p>':'',\r\n                // 豆瓣评分\r\n                douban_index_html = douban_index > 0 ? '<p class=\\'douban_index_item\\'>豆瓣评分：' +  createStars(douban_index) + ' <span>'  + douban_index + '</span></p>':'',\r\n                // 简介\r\n                synopsis_html = d['synopsis'] ? '<div class=\\'synopsis_item\\'><p>' + d['synopsis'] + '</p></div>':'',\r\n                // 海报\r\n                poster_html = (d['posters'] instanceof Array && d['posters'].length > 0) ? '<img src=\\'' + POSTERS_PATH + d['posters'][ Math.floor(Math.random() * d['posters'].length) ] + '\\'>': '',\r\n\r\n                date_html = '<p>添加日期：' + d['date'] + '</p>',\r\n\r\n                types = d['types'] ? d['types'].split(','):[],\r\n                tags = d['tags'] ? d['tags'].split(','):[],\r\n\r\n                addDate = new Date(d['date']),\r\n                now = new Date(),\r\n                banner='', j, tagsLen;\r\n\r\n            for(j = 0, tagsLen = tags.length; j < tagsLen; j++){\r\n                types_html += '<a href=\\'./admin/doSerialsAdmin.php\\'>' + tags[j] + '</a>';\r\n            }\r\n            for(j = 0, tagsLen = tags.length; j < tagsLen; j++){\r\n                tags_html += '<a href=\\'./admin/doSerialsAdmin.php\\'>' + tags[j] + '</a>';\r\n            }\r\n\r\n            types_html = types_html ? '<div class=\\'types_item\\'>' + types_html + '</div>': '';\r\n            tags_html = tags_html ? '<div class=\\'tags_item\\'>' + tags_html + '</div>':'';\r\n\r\n            // 添加 banner标志,评分大等于9分为 recommend banner，一周内添加的为 new banner\r\n            if(d['reco_index'] && d['reco_index'] >= 9.0){\r\n                banner = 'recommend';\r\n            } else if( (now.getTime() - addDate.getTime()) < 1000*3600*24*7 ){\r\n                banner = 'new_add';\r\n            }\r\n\r\n\r\n            html += '<div class=\\'grid-item ' + banner + '\\' data-id=\\'' + d['id'] + '\\'><div class=\\'serials_info\\'>' + poster_html +\r\n                c_name_html + f_name_html + director_html + acots_html + issuer_html + distinct_html +\r\n                state_html + duration_html + episode_number_html + season_number_html + reco_index_html +\r\n                type_index_html + douban_index_html + types_html + tags_html + date_html + '</div>' + synopsis_html +\r\n                '</div>';\r\n        }\r\n        return html;\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 加载serials数据\r\n     */\r\n    // todo 将全局变量移出函数\r\n    // todo 将判断滚动底部的逻辑分离到另外的函数\r\n    // todo 将html类名分离出来\r\n    function loadData(){\r\n        // 加载已全部加载，终止程序\r\n        if( hasScrolled || ((page - 1) * pageSize ) >= total){\r\n            return;\r\n        }\r\n\r\n        // 页面滚动到接近底部时，加载更多数据\r\n        if(Comman.isScrollOver(gridSelector)){\r\n            hasScrolled = true;     // 加载过程中，禁止重复触发\r\n\r\n            // ajax配置项\r\n            var options = {\r\n                type: 'GET',\r\n                url: './admin/doSerialsAdmin.php?act=get&pageSize=' + pageSize + '&page=' + (page++),\r\n                error: function (request) {\r\n                    console.log('页面请求失败...');\r\n                },\r\n                success: function (response) {\r\n\r\n                    var res = JSON.parse(response),\r\n                        d = res['data'],\r\n                        html, $items;\r\n\r\n                    total = res['total'];\r\n                    if (res['error']) {\r\n                        console.log(res['error']);\r\n                        return;\r\n                    };\r\n\r\n                    // 将得到的数据生成html\r\n                    html = createHtml(d);\r\n                    $items = $(html);\r\n\r\n                    // 将新内容添加到页面，并加载到masonry插件\r\n                    $(gridSelector).append($items).masonry('appended', $items);\r\n                   // $('.serialsCard').masonry('layout');\r\n\r\n                    // 加载完后，恢复滚动事件\r\n                    hasScrolled = false;\r\n\r\n                    // imagesLoaded插件配置\r\n                    $(gridSelector).imagesLoaded().progress( function(instance, image) {\r\n\r\n                        // img图片加载失败，删除这个img元素\r\n                        if(!image.isLoaded){\r\n                            image.img.outerHTML = '<img>';\r\n                        }\r\n\r\n                        // 每个图片加载完后，重新布局\r\n                        $(gridSelector).masonry('layout');\r\n                    }).always( function( instance ) {\r\n\r\n                        // 全部图片加载完成并重新布局后，如果页面仍有足够空间，继续加载数据\r\n                        loadData();\r\n                    });\r\n                }\r\n            }\r\n            $.ajax(options);\r\n\r\n\r\n            // 终止递归\r\n            return;\r\n        }\r\n    }\r\n\r\n    /* 点击电视剧卡片显示图片灯箱 */\r\n    function lightBox(){\r\n\r\n        // 获取图片路径的ajax配置\r\n        var options = {\r\n            type: 'GET',\r\n            url: './admin/doSerialsAdmin.php?act=getImagesById&id=' + $(this).attr('data-id'),\r\n            error: function (request) {\r\n                //throwError(\"页面请求失败...\");\r\n            },\r\n            success: function (response) {\r\n                var res = JSON.parse(response),\r\n                    posters = res['posters'] ? res['posters'] : [],\r\n                    images = res['images'] ? res['images'] : [],\r\n                    items = [],\r\n                    i,len;\r\n\r\n                if (res['error']) {\r\n                    console.log(res['error']);\r\n                    return;\r\n                }\r\n\r\n                // 将海报和剧照图片路径，格式化后合并至一个数组\r\n                for(i = 0, len = posters.length; i < len; i++){\r\n                    items.push({\r\n                        src: POSTERS_PATH + posters[i]\r\n                    });\r\n                }\r\n                for(i = 0, len = images.length; i < len; i++){\r\n                    items.push({\r\n                        src: IMAGES_PATH + images[i]\r\n                    });\r\n                }\r\n\r\n                // magnificPopup灯箱插件配置\r\n                $.magnificPopup.open({\r\n                    items:items,\r\n                    gallery: {\r\n                        enabled: true   // 多图篇配置为画廊\r\n                    },\r\n                    type:'image'\r\n                });\r\n\r\n            }\r\n        }\r\n        $.ajax(options);\r\n\r\n    }\r\n\r\n\r\n    return {\r\n        init:init,\r\n        show:function(){\r\n            $(containerSelector).show();\r\n            loadData();\r\n        },\r\n        hide:function(){\r\n            $(containerSelector).hide();\r\n        },\r\n        scroll:loadData,\r\n        resize:loadData\r\n    }\r\n\r\n\r\n}(window))"]}