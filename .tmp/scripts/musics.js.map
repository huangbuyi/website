{"version":3,"sources":["musics.js"],"names":["Musics","window","page","pageSize","total","curr_id","hasScrolled","containerSelector","gridSelector","init","options","ReferenceError","container","$","length","grid","masonry","itemSelector","gutter","fitWidth","loadData","Comman","isLoadData","type","url","error","request","console","log","success","response","res","JSON","parse","html","$items","createHtml","append","ajax","musics","template","iframe","i","len","replace","show","hide","scroll","resize"],"mappings":"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","file":"musics.js","sourcesContent":["/**\r\n * Created by Administrator on 2016/10/3.\r\n */\r\n\r\n// todo：将html代码分离为配置项\r\nvar Musics = (function(window){\r\n    var page = 1,\r\n        pageSize = 1,\r\n        total = 9999,\r\n        curr_id = 0,\r\n        hasScrolled = false,\r\n        containerSelector = '',\r\n        gridSelector = '';\r\n\r\n    function init(options){\r\n\r\n        if(typeof options !== 'object'){\r\n            throw new ReferenceError('Init Musics failed, param isn\\'t a object');\r\n            return;\r\n        }\r\n\r\n        if( typeof options.container === 'string' && $(options.container).length === 1 ){\r\n            containerSelector = options.container;\r\n        } else {\r\n            throw new ReferenceError('Init Musics failed, container selector doesn\\'t existed or more than one')\r\n            return;\r\n        }\r\n\r\n        if( typeof options.grid === 'string' && $(options.grid).length === 1 ){\r\n            gridSelector = options.grid;\r\n        } else {\r\n            throw new ReferenceError('Init Musics failed, grid selector isn\\'t existed or more than one');\r\n            return;\r\n        }\r\n\r\n\r\n        $(gridSelector).masonry({\r\n            itemSelector: '.music_item',     // 子元素\r\n            gutter: 10,\r\n            fitWidth: true                    // 宽度自适应\r\n        });\r\n    }\r\n\r\n    function loadData(){\r\n\r\n        if( hasScrolled || ((page - 1) * pageSize ) >= total){\r\n            return;\r\n        }\r\n\r\n        if(!Comman.isLoadData(gridSelector, '.music_item')) {\r\n            return;\r\n        }\r\n        hasScrolled = true;\r\n\r\n        var options = {\r\n            type:'GET',\r\n            url:'admin/doMusicsAdmin.php?act=get&pageSize=' + pageSize + '&page=' + (page++),\r\n            error: function (request) {\r\n                console.log('页面请求失败...');\r\n            },\r\n            success: function (response) {\r\n                var res = JSON.parse(response),\r\n                    html = '', $items;\r\n\r\n                total = res['total'];\r\n                if(res['error']){\r\n                    console.log(res['error'])\r\n                }\r\n\r\n                html = createHtml(res['musics']);\r\n                $items = $(html);\r\n\r\n                // 将新内容添加到页面，并加载到masonry插件\r\n                $(gridSelector).append($items).masonry('appended', $items);\r\n                $(gridSelector).masonry('layout');\r\n\r\n                hasScrolled = false;\r\n                loadData();\r\n\r\n            }\r\n        }\r\n        $.ajax(options)\r\n    }\r\n    function createHtml(musics){\r\n        var template = '<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=no'+\r\n            ' height=86 src=\"http://music.163.com/outchain/player?type={type}&id={id}&auto=0&height=66\"></iframe>',\r\n            html = '',\r\n            iframe = '',\r\n            i,len;\r\n        for(i = 0, len = musics.length; i < len; i++){\r\n            iframe = template.replace('{type}',musics[i]['type']);\r\n            iframe = iframe.replace('{id}',musics[i]['m_id']);\r\n            html += '<div class=\\'music_item\\'><div>' + iframe + '</div><div class=\\'music_comment\\'><p>' + musics[i]['comment'] + '</p><p class=\\'update_date\\'>' + musics[i]['date'] + '</p></div></div>';\r\n        }\r\n        return html;\r\n    }\r\n\r\n    return {\r\n        init:init,\r\n        show: function(){\r\n            console.log('music');\r\n            $(containerSelector).show();\r\n            loadData();\r\n        },\r\n        hide:function(){\r\n            $(containerSelector).hide();\r\n        },\r\n        scroll:loadData,\r\n        resize:loadData\r\n    }\r\n\r\n\r\n\r\n}(window));"]}